import{j as a,u as x,r as n,A as y,C as S,O as w,P as f,Q as v}from"./index-BZAXjjD_.js";import{t as b}from"./index-mhOicfQu.js";import{c as C,u as R,h as A,b as j,e as M,aN as m,i as F}from"./App-heRoAE-M.js";const I=C(a.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),P=()=>{const{data:r}=R(),{t:i}=x(),{importAppState:u}=n.useContext(y),{importCollectionState:p}=n.useContext(S),d=A(),[c,E]=n.useState(r??""),h=n.useMemo(()=>b(e=>{try{return JSON.parse(w.decompress(decodeURIComponent(e),{inputEncoding:"Base64"}))}catch{return{}}},500),[]),t=n.useMemo(()=>{try{let e=h(r??c.split("/").pop()??"");if(!Array.isArray(e.savedStops)||!f(e.savedStops))throw new Error("Error in parsing savedStops");if(!Array.isArray(e.savedEtas)||!f(e.savedEtas))throw new Error("Error in parsing savedEtas");if(!Array.isArray(e.collections))throw new Error("Error in parsing collections");for(let o=0;o<e.collections.length;++o){if(typeof e.collections[o].name!="string")throw new Error("Error in parsing collections");for(let s=0;s<e.collections[o].list.length;++s)if(typeof e.collections[o].list[s]!="string")throw new Error("Error in parsing collections");for(let s=0;s<e.collections[o].schedules.length;++s){if(typeof e.collections[o].schedules[s].day!="number")throw new Error("Error in parsing collections");if(typeof e.collections[o].schedules[s].start.hour!="number")throw new Error("Error in parsing collections");if(typeof e.collections[o].schedules[s].start.minute!="number")throw new Error("Error in parsing collections");if(typeof e.collections[o].schedules[s].end.hour!="number")throw new Error("Error in parsing collections");if(typeof e.collections[o].schedules[s].end.minute!="number")throw new Error("Error in parsing collections")}}return e}catch(e){console.error(e)}return{}},[h,r,c]),l=n.useMemo(()=>JSON.stringify(t,null,2),[t]),g=n.useCallback(()=>{l!=="{}"&&(p({savedStops:t.savedStops??[],savedEtas:t.savedEtas??[],collections:t.collections??[],collectionDrawerRoute:null,collectionIdx:null}),u({geoPermission:null,compassPermission:"default",manualGeolocation:null,searchRoute:"",selectedRoute:"1-1-CHUK-YUEN-ESTATE-STAR-FERRY",routeSearchHistory:t.routeSearchHistory??[],isRouteFilter:t.isRouteFilter??!0,busSortOrder:t.busSortOrder??"KMB first",numPadOrder:t.numPadOrder??"123456789c0b",etaFormat:t.etaFormat??"diff",_colorMode:t._colorMode??"system",energyMode:t.energyMode??!1,platformMode:t.platformMode??!1,vibrateDuration:t.vibrateDuration??1,isVisible:!0,analytics:t.analytics??!0,refreshInterval:t.refreshInterval??30,annotateScheduled:t.annotateScheduled??!0,isRecentSearchShown:t.isRecentSearchShown??!0,fontSize:t.fontSize??16,searchRange:t.searchRange??v}),d("/"))},[t,l,u,p,d]);return a.jsxs(j,{sx:O,children:[a.jsx(M,{variant:"h6",sx:{textAlign:"center"},children:i("資料匯入")}),!r&&a.jsx(m,{variant:"outlined",value:c,onChange:({target:{value:e}})=>E(e),fullWidth:!0,label:i("匯出網址")}),a.jsx(m,{multiline:!0,maxRows:15,value:l,disabled:!0,fullWidth:!0,spellCheck:!1}),a.jsx(F,{startIcon:a.jsx(I,{}),variant:"outlined",disabled:l==="{}",onClick:g,sx:T,children:i("Accept")})]})},O={display:"flex",flexDirection:"column",justifyContent:"flex-start",flex:1,gap:1},T={color:r=>r.palette.mode==="light"?r.palette.text.primary:r.palette.primary.main,borderColor:r=>r.palette.mode==="light"?r.palette.text.primary:r.palette.primary.main};export{P as default};
