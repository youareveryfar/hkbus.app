function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/SharingModal-C1sKe61M.js","assets/index-BZAXjjD_.js","assets/index-BSkLjl09.css","assets/TimeReport-DpF75XcQ.js","assets/App-heRoAE-M.js","assets/App-C05wK8aK.css","assets/CircularProgress-BJX6oDjs.js","assets/Snackbar-CMBvQPMM.js","assets/RouteMap-nlfQVabg.js","assets/TileLayer-BM2OEKST.js","assets/CompassControl-CCT03F-n.js","assets/index-mhOicfQu.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{j as e,u as A,e as N,r as l,D as T,A as oe,B as ae,F as ee,q as H,v as pe,C as Q,t as L,b as X,h as te,_ as re,g as xe,z as he,G as ge}from"./index-BZAXjjD_.js";import{c as _,h as le,f as W,i as Z,b as I,j as me,k as be,l as se,e as O,L as je,m as Ce,I as R,P as ve,R as Se,D as ke,B as ye,n as $e,d as we,u as Me}from"./App-heRoAE-M.js";import{S as ie}from"./Star-BCYx7LXs.js";import{A as De,a as Ie,b as ze,T as Re}from"./TimeReport-DpF75XcQ.js";import{I as Be,S as Oe}from"./Share-CGVMc8Ez.js";import{S as Le}from"./StopRouteList-DSTo5TQM.js";import{D as Ae}from"./DialogTitle-D5e51YJn.js";import{C as Te}from"./Close-BhYzwXfU.js";import"./CircularProgress-BJX6oDjs.js";const _e=_(e.jsx("path",{d:"m12 7.27 4.28 10.43-3.47-1.53-.81-.36-.81.36-3.47 1.53zM12 2 4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"}),"NavigationOutlined"),Ee=_(e.jsx("path",{d:"M10 20h4c0 1.1-.9 2-2 2s-2-.9-2-2m4-11c0 2.61 1.67 4.83 4 5.66V17h2v2H4v-2h2v-7c0-2.79 1.91-5.14 4.5-5.8v-.7c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5v.7c.71.18 1.36.49 1.95.9C14.54 6.14 14 7.51 14 9m10-1h-3V5h-2v3h-3v2h3v3h2v-3h3z"}),"NotificationAdd"),Pe=_(e.jsx("path",{d:"M20 18.69 7.84 6.14 5.27 3.49 4 4.76l2.8 2.8v.01c-.52.99-.8 2.16-.8 3.42v5l-2 2v1h13.73l2 2L21 19.72zM12 22c1.11 0 2-.89 2-2h-4c0 1.11.89 2 2 2m6-7.32V11c0-3.08-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68c-.15.03-.29.08-.42.12-.1.03-.2.07-.3.11h-.01c-.01 0-.01 0-.02.01-.23.09-.46.2-.68.31 0 0-.01 0-.01.01z"}),"NotificationsOff"),Fe=_([e.jsx("path",{d:"M12 4c1.93 0 5 1.4 5 5.15 0 2.16-1.72 4.67-5 7.32-3.28-2.65-5-5.17-5-7.32C7 5.4 10.07 4 12 4m0-2C8.73 2 5 4.46 5 9.15c0 3.12 2.33 6.41 7 9.85 4.67-3.44 7-6.73 7-9.85C19 4.46 15.27 2 12 2"},"0"),e.jsx("path",{d:"M12 7c-1.1 0-2 .9-2 2s.9 2 2 2a2 2 0 1 0 0-4M5 20h14v2H5z"},"1")],"PinDropOutlined"),He=_(e.jsx("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder"),Ne=_(e.jsx("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorderOutlined"),Ue=_(e.jsx("path",{d:"m18 12 4-4-4-4v3H3v2h15zM6 12l-4 4 4 4v-3h15v-2H6z"}),"SyncAlt"),qe=({routeId:t,stopId:s})=>{const{t:n}=A(),o=N(),{db:{routeList:a,holidays:r,stopList:i,serviceDayMap:h}}=l.useContext(T),{vibrateDuration:v}=l.useContext(oe),{route:c,stops:u,co:p,gtfsId:m}=a[t],x=le(),b=l.useMemo(()=>ae(r,new Date),[r]),z=l.useMemo(()=>{const w=Object.entries(a).reduce((f,[$,M])=>{if($===t)return f;const{co:g,route:k,gtfsId:P}=M;return p[0]==="gmb"&&m&&m!==P?f:k===c&&JSON.stringify(p)===JSON.stringify(g)?[...f,[$,M]]:f},[]).sort(([,f],[,$])=>{const M=ee(f.route,f.freq,b,h),g=ee($.route,$.freq,b,h);if(M===g){const k=i[Object.values(u)[0][0]],P=i[Object.values(u)[0].slice(-1)[0]],G=i[Object.values(f.stops)[0][0]],J=i[Object.values(f.stops)[0].slice(-1)[0]],K=H(G.location,P.location)+H(k.location,J.location),d=i[Object.values($.stops)[0][0]],j=i[Object.values($.stops)[0].slice(-1)[0]],S=H(d.location,P.location)+H(k.location,j.location);return K<S?-1:1}return M>g?-1:1}).map(([f])=>f).filter(f=>f.toLowerCase()!==t);if(w.length===0)return null;const y=i[s].location;let D=Object.values(a[w[0]].stops)[0],C=-1,E=9999999;for(let f=0;f<D.length;++f){let $=H(y,i[D[f]].location);$<E&&(E=$,C=f)}return`/${o}/route/${w[0].toLowerCase()}/${D[C]}%2C${C}`},[c,p,m,a,i,b,t,u,h,o,s]),B=l.useCallback(w=>y=>{y.preventDefault(),w&&(pe(v),x(w))},[x,v]);return z&&e.jsxs(e.Fragment,{children:[e.jsx(W,{orientation:"vertical",sx:Ve}),e.jsx(Z,{variant:"text","aria-label":"open-timetable",sx:We,size:"small",startIcon:e.jsx(Ue,{}),onClick:B(z),children:n("對頭線")})]})},Ve={position:"absolute",top:"0",left:"calc(64px + 2%)"},We={color:t=>t.palette.getContrastText(t.palette.background.default),position:"absolute",top:0,left:"2%",flexDirection:"column",justifyContent:"center","& > .MuiButton-label":{flexDirection:"column",justifyContent:"center"},"& > .MuiButton-startIcon":{margin:0}},Ge=({routeId:t})=>{const{db:{routeList:s}}=l.useContext(T),{t:n}=A(),o=N(),{route:a,co:r,gtfsId:i}=s[t],h=l.useMemo(()=>r.map(c=>{switch(c){case"ctb":return[c,`https://mobile.citybus.com.hk/nwp3/?f=1&ds=${a}&dsmode=1&l=${o==="zh"?0:1}`];case"kmb":return[c,`https://search.kmb.hk/KMBWebSite/?action=routesearch&route=${a}&lang=${o==="zh"?"zh-hk":"en"}`];case"gmb":return[c,`https://h2-app-rr.hkemobility.gov.hk/ris_page/get_gmb_detail.php?lang=${o==="zh"?"TC":"EN"}&route_id=${i}`];case"nlb":return[c,`https://www.nlb.com.hk/route?q=${a}`];case"lrtfeeder":return[c,`https://www.mtr.com.hk/${o==="zh"?"ch":"en"}/customer/services/searchBusRouteDetails.php?routeID=${a}`];case"lightRail":return[c,`https://www.mtr.com.hk/${o==="zh"?"ch":"en"}/customer/services/schedule_index.html`];case"mtr":return[c,`https://www.mtr.com.hk/${o==="zh"?"ch":"en"}/customer/services/train_service_index.html`];default:return[c,""]}}),[r,a,o,i]),v=l.useCallback(c=>()=>{c&&window.open(c,"_blank")},[]);return e.jsx(I,{sx:Je,children:h.map(([c,u])=>e.jsx(Z,{onClick:v(u),variant:"outlined",size:"small",endIcon:e.jsx(me,{}),children:n(c)},c))})},Je={display:"flex",gap:1},Ke=({routeId:t,open:s,onClose:n})=>{const{t:o}=A(),{db:{routeList:a,holidays:r}}=l.useContext(T),{freq:i,jt:h}=a[t],v=l.useMemo(()=>ae(r,new Date),[r]),c=l.useMemo(()=>({onClose:()=>{n()}}),[n]),u=l.useMemo(()=>({sx:Qe}),[]);return e.jsxs(be,{open:s,ModalProps:c,PaperProps:u,anchor:"right",children:[h&&e.jsxs(e.Fragment,{children:[e.jsx(se,{sx:ne,children:e.jsxs(I,{sx:Xe,children:[e.jsx(O,{variant:"subtitle1",children:o("車程")}),e.jsxs(O,{variant:"subtitle1",children:[Math.round(parseFloat(h)),o("分鐘")]})]})}),e.jsx(W,{sx:{width:"80%"}})]}),e.jsx(je,{sx:{flex:1,overflow:"auto"},children:i&&Object.entries(i).map(([p,m])=>e.jsxs(se,{sx:ne,children:[e.jsx(O,{variant:"subtitle1",children:o(Ye[p])}),Object.entries(m).sort((x,b)=>x[0]<b[0]?-1:1).map(([x,b])=>e.jsxs(I,{sx:st(x,b,p,v)?et:Ze,children:[e.jsxs(O,{variant:"body1",children:[x," ",b?`- ${b[0]}`:""]}),b?e.jsxs(O,{variant:"body1",children:[parseInt(b[1],10)/60,o("分鐘")]}):e.jsx(e.Fragment,{})]},`${p}-${x}`))]},p))}),e.jsx(W,{sx:{width:"80%",my:2}}),e.jsx(Ge,{routeId:t})]})},Ye={31:"星期一至五",287:"星期一至五",415:"星期一至五",63:"星期一至六",319:"星期一至六",447:"星期一至六",416:"星期六至日",480:"星期六至日",266:"星期二至四",271:"星期一至四",272:"星期五",288:"星期六",320:"星期日及公眾假期",448:"星期日及公眾假期",511:"所有日子",111:"除星期三外",1:"星期一",2:"星期二",4:"星期三",8:"星期四",16:"星期五",32:"星期六",64:"星期日",257:"星期一",258:"星期二",260:"星期三",264:"星期四",999:"未知日子"},Y={31:[!1,!0,!0,!0,!0,!0,!1],287:[!1,!0,!0,!0,!0,!0,!1],415:[!1,!0,!0,!0,!0,!0,!1],63:[!1,!0,!0,!0,!0,!0,!0],319:[!1,!0,!0,!0,!0,!0,!0],447:[!1,!0,!0,!0,!0,!0,!0],416:[!0,!1,!1,!1,!1,!1,!0],480:[!0,!1,!1,!1,!1,!1,!0],266:[!1,!1,!0,!0,!0,!1,!1],271:[!1,!0,!0,!0,!0,!1,!1],272:[!1,!1,!1,!1,!1,!0,!1],288:[!1,!1,!1,!1,!1,!1,!0],320:[!0,!1,!1,!1,!1,!1,!1],448:[!0,!1,!1,!1,!1,!1,!1],511:[!0,!0,!0,!0,!0,!0,!0],111:[!0,!0,!0,!1,!0,!0,!0],1:[!1,!0,!1,!1,!1,!1,!1],2:[!1,!1,!0,!1,!1,!1,!1],4:[!1,!1,!1,!0,!1,!1,!1],8:[!1,!1,!1,!1,!0,!1,!1],16:[!1,!1,!1,!1,!1,!0,!1],32:[!1,!1,!1,!1,!1,!1,!0],64:[!0,!1,!1,!1,!1,!1,!1],257:[!1,!0,!1,!1,!1,!1,!1],258:[!1,!1,!0,!1,!1,!1,!1],260:[!1,!1,!1,!0,!1,!1,!1],264:[!1,!1,!1,!1,!0,!1,!1],999:[!1,!1,!1,!1,!1,!1,!1]},Qe={height:"100vh",width:"80%",maxWidth:"320px",paddingTop:"56px",paddingLeft:"20px",backgroundColor:t=>t.palette.background.default,backgroundImage:"none",overflow:"hidden"},ne={flexDirection:"column",alignItems:"flex-start"},Xe={display:"flex",justifyContent:"space-between",width:"80%"},Ze={display:"flex",justifyContent:"space-between",width:"80%"},et={display:"flex",justifyContent:"space-between",width:"80%",color:t=>t.palette.primary.main,borderBottom:"1px solid"},tt=(t,s)=>{const n=new Date().getDay();return!!(Y[t]&&(Y[t][n]||Y[t][0]&&s))},st=(t,s,n,o)=>{if(!tt(n,o))return!1;const a=new Date,r=`${a.getHours()}${a.getMinutes()}`;return s?t<=r&&r<=s[0]:!1},nt=({routeId:t})=>{const[s,n]=l.useState(!1),{t:o}=A();return e.jsxs(e.Fragment,{children:[e.jsx(W,{orientation:"vertical",sx:ot}),e.jsx(Z,{variant:"text","aria-label":"open-timetable",sx:at,size:"small",startIcon:e.jsx(Ce,{}),onClick:()=>n(!0),children:o("時間表")}),e.jsx(Ke,{routeId:t,open:s,onClose:()=>n(!1)})]})},ot={position:"absolute",top:"0",right:"calc(64px + 2%)"},at={color:t=>t.palette.getContrastText(t.palette.background.default),flexDirection:"column",justifyContent:"center","& > .MuiButton-label":{flexDirection:"column",justifyContent:"center"},"& > .MuiButton-startIcon":{margin:0}},rt=({routeId:t})=>{const{savedEtas:s,setCollectionDrawerRoute:n}=l.useContext(Q);return e.jsx(R,{sx:lt,size:"small",onClick:()=>{const o=`${t.toUpperCase()}`;n(o)},children:s.includes(t)?e.jsx(ie,{}):e.jsx(Ne,{})})},lt={color:t=>t.palette.getContrastText(t.palette.background.default),flexDirection:"column",justifyContent:"center","& > .MuiButton-label":{flexDirection:"column",justifyContent:"center"},"& > .MuiButton-startIcon":{margin:0}},it=({routeId:t,stopId:s})=>{const{t:n}=A(),o=N(),{db:{routeList:a}}=l.useContext(T),{route:r,orig:i,dest:h,nlbId:v}=a[t];return e.jsxs(ve,{id:"route-eta-header",sx:ct,elevation:0,children:[e.jsx(Se,{routeNo:n(r),component:"h1",align:"center"}),e.jsxs(O,{component:"h2",variant:"caption",align:"center",children:[n("往")," ",L(h[o])," ",v?n("由")+" "+L(i[o]):""]}),e.jsx(qe,{routeId:t,stopId:s}),e.jsxs(I,{sx:ut,children:[e.jsx(rt,{routeId:t}),e.jsx(nt,{routeId:t})]})]})},ct={textAlign:"center",background:"transparent",position:"relative"},ut={position:"absolute",top:0,right:"2%"},ft=X.forwardRef((t,s)=>{const{routeId:n,stopId:o,stopIdx:a,idx:r,onShareClick:i,onSummaryClick:h,onStopInfoClick:v}=t,{db:{routeList:c,stopList:u}}=l.useContext(T),{savedEtas:p,setCollectionDrawerRoute:m,collections:x}=l.useContext(Q),{alarmStopId:b,toggleStopAlarm:z}=l.useContext(te),{isStopAlarm:B}=l.useContext(te),{t:w}=A(),y=N(),{fares:D,faresHoliday:C}=c[n],E=u[o],f=l.useMemo(()=>p.includes(`${n.toUpperCase()}/${r}`)||x.reduce((g,k)=>g||k.list.includes(`${n.toUpperCase()}/${r}`),!1),[p,x,n,r]),$=l.useCallback(g=>{i({routeId:n,seq:r,stopId:o,event:g})},[i,n,r,o]),M=l.useCallback((g,k)=>{h(r,k)},[r,h]);return e.jsxs(De,{id:`stop-${r}`,expanded:a===r&&navigator.userAgent!=="prerendering",onChange:M,TransitionProps:{unmountOnExit:!0},ref:s,sx:dt,children:[e.jsxs(Ie,{sx:pt,children:[e.jsxs(O,{component:"h3",variant:"body1",sx:{fontWeight:700},children:[r+1,". ",L(E.name[y])]}),e.jsxs(O,{variant:"body2",children:[D&&D[r]?w("車費")+": $"+D[r]:"",C&&C[r]?"　　　　"+w("假日車費")+": $"+C[r]:""]})]}),e.jsxs(ze,{sx:xt,children:[e.jsx(Re,{containerSx:ht,routeId:`${n.toUpperCase()}`,seq:r}),e.jsxs(I,{display:"flex",flexDirection:"column",alignItems:"flex-end",children:[e.jsxs(I,{children:[B&&e.jsx(R,{"aria-label":"alert",onClick:()=>z(o),style:{backgroundColor:"transparent"},size:"large",children:b===o?e.jsx(Pe,{}):e.jsx(Ee,{})}),e.jsx(R,{"aria-label":"stop-info",onClick:v,style:{background:"transparent"},size:"large",children:e.jsx(Be,{})})]}),e.jsxs(I,{children:[e.jsx(R,{"aria-label":"share",onClick:$,style:{backgroundColor:"transparent"},size:"large",children:e.jsx(Oe,{})}),e.jsx(R,{"aria-label":"favourite",onClick:()=>{const g=`${n.toUpperCase()}/${r}`;m(g)},style:{backgroundColor:"transparent"},size:"large",children:f?e.jsx(ie,{sx:gt}):e.jsx(He,{})})]})]})]})]})}),dt={border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&.Mui-expanded":{margin:"auto"}},pt={backgroundColor:t=>t.palette.mode==="dark"?t.palette.background.default:"rgba(0, 0, 0, .03)","&.Mui-expanded":{borderBottom:"1px solid rgba(0, 0, 0, .125)",minHeight:44},minHeight:44,"& .MuiAccordionSummary-content":{margin:"8px 0",flexDirection:"column","&.Mui-expanded":{margin:"8px 0"}}},xt={display:"flex",alignItems:"center",pl:2,pr:1,py:1,justifyContent:"space-between"},ht={flex:1},gt={color:t=>t.palette.mode==="dark"?t.palette.primary.main:"inherit"},mt=X.lazy(()=>re(()=>import("./SharingModal-C1sKe61M.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),bt=({routeId:t,stopIdx:s,stopIds:n,handleChange:o,onStopInfo:a})=>{const[r,i]=l.useState(null),h=l.useRef([]);l.useEffect(()=>{if(h.current[s]){const c=setTimeout(()=>{var u;(u=h.current[s])==null||u.scrollIntoView({behavior:"smooth",block:"center"})},50);return()=>{clearTimeout(c)}}},[s]);const v=l.useCallback(c=>u=>{h.current[c]=u},[]);return e.jsxs(I,{sx:jt,children:[n.map((c,u)=>e.jsx(ft,{routeId:t,stopId:c,stopIdx:s,idx:u,onShareClick:p=>i(p),onSummaryClick:o,onStopInfoClick:a,ref:v(u)},"stop-"+u)),r&&e.jsx(l.Suspense,{fallback:e.jsx(e.Fragment,{}),children:e.jsx(mt,{...r})})]})},jt={overflowY:"scroll"},Ct=({open:t,stops:s,onClose:n})=>{var u;const{db:{stopList:o}}=l.useContext(T),{savedStops:a,updateSavedStops:r}=l.useContext(Q),i=N(),h=l.useMemo(()=>s.reduce((p,m)=>p||a.includes(m.join("|")),!1),[s,a]),v=l.useCallback(()=>{var p;if((p=o[s[0][1]])!=null&&p.location){const{lat:m,lng:x}=o[s[0][1]].location;window.open(`https://www.google.com/maps/dir/?api=1&destination=${m},${x}&travelmode=walking`,"_blank")}},[o,s]),c=l.useCallback(()=>{var p;if((p=o[s[0][1]])!=null&&p.location){const{lat:m,lng:x}=o[s[0][1]].location;window.open(`https://www.google.com/maps/?q=${m},${x}`,"_blank")}},[o,s]);return e.jsxs(ke,{open:t,onClose:n,sx:vt,children:[e.jsxs(Ae,{sx:St,children:[e.jsxs(I,{children:[e.jsx(R,{onClick:()=>r(s[0].join("|")),children:h?e.jsx(ye,{}):e.jsx($e,{})}),(u=o[s[0][1]])==null?void 0:u.name[i],"  ",e.jsx(R,{onClick:v,children:e.jsx(_e,{})}),e.jsx(R,{onClick:c,children:e.jsx(Fe,{})})]}),e.jsx(I,{children:e.jsx(R,{onClick:n,children:e.jsx(Te,{})})})]}),e.jsx(we,{children:e.jsx(Le,{stops:s,isFocus:!0})})]})},vt={"& .MuiPaper-root":{width:"100%",marginTop:"90px",height:"calc(100vh - 100px)"},"& .MuiDialogContent-root":{padding:0}},St={backgroundColor:t=>t.palette.background.default,color:t=>t.palette.primary.main,display:"flex",justifyContent:"space-between"};var kt={compareTwoStrings:ce,findBestMatch:yt};function ce(t,s){if(t=t.replace(/\s+/g,""),s=s.replace(/\s+/g,""),t===s)return 1;if(t.length<2||s.length<2)return 0;let n=new Map;for(let a=0;a<t.length-1;a++){const r=t.substring(a,a+2),i=n.has(r)?n.get(r)+1:1;n.set(r,i)}let o=0;for(let a=0;a<s.length-1;a++){const r=s.substring(a,a+2),i=n.has(r)?n.get(r):0;i>0&&(n.set(r,i-1),o++)}return 2*o/(t.length+s.length-2)}function yt(t,s){if(!$t(t,s))throw new Error("Bad arguments: First argument should be a string, second should be an array of strings");const n=[];let o=0;for(let r=0;r<s.length;r++){const i=s[r],h=ce(t,i);n.push({target:i,rating:h}),h>n[o].rating&&(o=r)}const a=n[o];return{ratings:n,bestMatch:a,bestMatchIndex:o}}function $t(t,s){return!(typeof t!="string"||!Array.isArray(s)||!s.length||s.find(function(n){return typeof n!="string"}))}const wt=xe(kt),Mt=X.lazy(()=>re(()=>import("./RouteMap-nlfQVabg.js"),__vite__mapDeps([8,1,2,9,10,11,4,5]))),Ft=()=>{const{id:t,panel:s}=Me(),{AppTitle:n,db:{routeList:o,stopList:a,stopMap:r}}=l.useContext(T),{updateSelectedRoute:i,energyMode:h,geoPermission:v,geolocation:c}=l.useContext(oe),u=Dt(t.toUpperCase(),o),p=o[u],{route:m,stops:x,co:b,orig:z,dest:B,fares:w}=p,y=l.useMemo(()=>It(b,x).map(d=>[d,a[d]]).filter(([,d])=>d!=null).map(([d])=>d),[b,a,x]),D=l.useMemo(()=>{if(v==="granted"){const d=y.map((j,S)=>[S,H(c.current,a[j].location)]).sort((j,S)=>j[1]-S[1])[0];if(d.length>0)return d[0]}return 0},[v,c,a,y]),C=l.useMemo(()=>{if(s!==void 0){const[d,j]=s.split(",");if(d===void 0||j===void 0)return parseInt(s,10);{const S=parseInt(j,10);let U=0,q=9999999;for(let ue in x){let fe=x[ue].reduce((F,V,de)=>(V===d&&F.push(de),F),[]);for(let F of fe)if(F>=0){let V=Math.abs(F-S);V<q&&(U=F,q=V)}}return U}}return D},[s,x,D]),[E,f]=l.useState(!1),$=l.useMemo(()=>zt(b,x,r,C),[b,C,r,x]),{t:M}=A(),g=N(),k=le(),P=l.useCallback((d,j)=>{if(j&&C!==d){let S=x[Object.keys(x).sort()[0]][d];k(`/${g}/route/${t}/${S}%2C${d}`,{replace:!0})}C===d&&!j&&f(!0)},[k,g,t,C,x]),G=l.useCallback(d=>{C===d&&f(!0),k(`/${g}/route/${t}/${d}`,{replace:!0})},[k,g,t,C]),J=l.useCallback(()=>{f(!0)},[f]),K=l.useCallback(()=>{f(!1)},[f]);return l.useEffect(()=>{var d;return f(!1),(d=document.getElementById("render"))==null||d.setAttribute("value","done"),i(t),()=>{var j;(j=document.getElementById("render"))==null||j.setAttribute("value","")}},[t,i]),l.useEffect(()=>{t.toUpperCase()!==u.toUpperCase()&&k(`/${g}/route/${u.toLowerCase()}`)},[t,u,g,k]),l.useEffect(()=>{const d=()=>{const j=w?w.filter((S,U,q)=>q.indexOf(S)===U).map(S=>`$${S}`):[];return g==="zh"?`路線${m}由${z.zh}出發，以${B.zh}為終點，`+(j.length?`分段車費為${j.join("、")}，`:"")+`途經${y.map(S=>a[S].name.zh).join("、")}。`:`Route ${m} is from ${L(z.en)} to ${L(B.en)}`+(j.length?`, section fees are ${j.join(", ")}. `:". ")+"Stops: "+L(y.map(S=>a[S].name.en).join(", "))+". "};he({title:m+" "+M("往")+" "+L(B[g])+" - "+M(n),description:d(),lang:g}),ge({route:p,stopList:a,t:M,lang:g})},[n,B,w,g,z.en,z.zh,m,a,y,M,p]),e.jsxs(e.Fragment,{children:[e.jsx("input",{hidden:!0,id:"render"}),e.jsx(it,{routeId:u,stopId:y[C]}),!h&&navigator.userAgent!=="prerendering"&&e.jsx(l.Suspense,{fallback:null,children:e.jsx(Mt,{routeId:u,stopIds:y,stopIdx:C,route:m,companies:b,onMarkerClick:G})}),e.jsx(bt,{routeId:u,stopIdx:C,routeListEntry:p,stopIds:y,handleChange:P,onStopInfo:J}),e.jsx(Ct,{open:E,stops:$,onClose:K})]})},Dt=(t,s)=>{if(s[t]!==void 0)return t;const n=t.split("-")[0];return wt.findBestMatch(t.toUpperCase(),Object.keys(s).filter(o=>o.startsWith(n))).bestMatch.target},It=(t,s)=>{for(let n=0;n<t.length;++n)if(t[n]in s)return s[t[n]];return[]},zt=(t,s,n,o)=>{for(let a=0;a<t.length;++a)if(t[a]in s)return[[t[a],s[t[a]][o]]].concat(n[s[t[a]][o]]??[]);return[]};export{Ft as default};
