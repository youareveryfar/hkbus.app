import{u as S,e as h,r as s,C as g,D as f,j as o,b as T,A as j}from"./index-BZAXjjD_.js";import{B as k,D as v}from"./DbRenewReminder-TdIjLY0i.js";import{e as m,T as w,a as R,P as y,b as L}from"./App-heRoAE-M.js";import{S as M}from"./index-bFHy5SPL.js";import{S as B}from"./StopRouteList-DSTo5TQM.js";import"./CircularProgress-BJX6oDjs.js";const I=({stopTab:u,onChangeTab:r})=>{const{t:l}=S(),p=h(),{savedStops:i}=s.useContext(g),{db:{stopList:c}}=s.useContext(f);return i.length===0?o.jsxs(o.Fragment,{children:[o.jsx(m,{variant:"h6",children:l("未有收藏車站")}),o.jsx(m,{variant:"body1",children:l("請按下圖指示增加")})]}):o.jsx(w,{value:u,onChange:(t,n)=>r(n,!0),sx:$,variant:"scrollable",scrollButtons:!0,children:i.map(t=>t.split("|")).filter(([,t])=>c[t]).map(([t,n])=>o.jsx(R,{label:c[n].name[p],value:`${t}|${n}`,disableRipple:!0},`stops-${n}`))})},$={background:u=>u.palette.background.default,minHeight:"36px","& .MuiTab-root":{alignItems:"center",justifyContent:"center",paddingTop:0,paddingBottom:0,minHeight:"32px"},"& .MuiTabs-flexContainer":{justifyContent:"flex-start"}},D=T.forwardRef(({stopTab:u,onChangeTab:r},l)=>{const{savedStops:p}=s.useContext(g),{db:{stopList:i,stopMap:c}}=s.useContext(f),t=s.useRef(u);s.useImperativeHandle(l,()=>({changeTab:e=>{t.current=e}}));const n=s.useMemo(()=>p.filter(e=>e.split("|")[1]in i),[p,i]),d=s.useCallback(()=>{let e=n.indexOf(t.current);return e!==-1?e:-1},[n]),b=s.useMemo(()=>n.map(e=>{var x;if(e==="")return[];const a=[e.split("|")];return(x=c[a[0][1]])==null||x.forEach(C=>a.push(C)),a}),[n,c]);return o.jsx(M,{index:d(),onChangeIndex:e=>{r(n[e])},children:b.map((e,a)=>o.jsx(B,{stops:e,isFocus:d()===a},`savedStops-${a}`))})}),z=()=>{const{colorMode:u}=s.useContext(j),{savedStops:r}=s.useContext(g),{db:{stopList:l}}=s.useContext(f),p=h(),i=s.useRef(null),c=s.useMemo(()=>{try{const e=localStorage.getItem("stopTab")??"|";if(e&&r.includes(e)&&l[e.split("|")[1]])return e;for(let a=0;a<r.length;++a){let x=r[a].split("|")[1];if(l[x])return r[a]}}catch(e){console.error(e)}return""},[r,l]),[t,n]=s.useState(c),d=s.useCallback(e=>t===""?"unset":e.palette.mode==="dark"?e.palette.background.default:"white",[t]);s.useEffect(()=>{localStorage.setItem("stopTab",t)},[t]);const b=s.useCallback(e=>{var a;n(e),(a=i.current)==null||a.changeTab(e)},[]);return o.jsxs(y,{sx:{...E,bgcolor:d,backgroundImage:t===""?`url(/img/stop-bookmark-guide-${u}-${p}.png)`:"unset",opacity:t===""?"0.8":"unset"},square:!0,elevation:0,children:[o.jsx(I,{stopTab:t,onChangeTab:b}),o.jsx(k,{}),o.jsx(v,{}),o.jsx(L,{sx:{flex:1,overflow:"scroll"},children:o.jsx(D,{ref:i,stopTab:t,onChangeTab:b})})]})},E={textAlign:"center",display:"flex",flexDirection:"column",overflow:"auto",width:"100%",flex:1,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat"};export{z as default};
